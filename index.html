<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Model - CPP DiTTA</title>

    <!-- libs -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/styles.css">
</head>

<body>

    <!-- shared navbar -->
    <div id="navbar"></div>
    <script>
        fetch("navbar.html").then(r => r.text()).then(h => { document.getElementById("navbar").innerHTML = h; });
    </script>

    <div class="container">
        <div class="content-wrapper">

            <h1 class="text-center my-4">CPP-DiTTA Interactive Model</h1>
            <h1 class="text-center my-4">Step 1 - Predicting Damage Location</h1>
            <div class="text-center">
                <p class="lead">First, seven sensors are used to read stress values along the length of the 24-inch
                    beam.
                    The values of these sensors will give insight into the location of any damage along the beam, if
                    any.</p>
                <p class="lead">Input stress values for each node on the beam. These may range from 0 to 10,000 psi):
                </p>
            </div>

            <!-- Case buttons -->
            <div class="text-center my-4">
                <h4>Select a Stress Scenario:</h4>
                <div class="btn-group" role="group" aria-label="Case Presets">
                    <button class="btn btn-outline-primary mx-2" type="button"
                        onclick="setCase([8200,4541,3347,1797,1322,877,475])">Case 1</button>
                    <button class="btn btn-outline-primary mx-2" type="button"
                        onclick="setCase([7186,7316,3316,1794,1320,876,475])">Case 2</button>
                    <button class="btn btn-outline-primary mx-2" type="button"
                        onclick="setCase([4846,4848,3778,1782,1315,874,474])">Case 3</button>
                    <button class="btn btn-outline-primary mx-2" type="button"
                        onclick="setCase([4826,4402,4084,1746,1296,865,469])">Case 4</button>
                    <button class="btn btn-outline-primary mx-2" type="button"
                        onclick="setCase([4822,4394,3360,4294,1470,828,441])">Case 5</button>
                    <button class="btn btn-outline-primary mx-2" type="button"
                        onclick="setCase([4819,4390,3350,1819,1428,1844,527])">Case 6</button>
                    <button class="btn btn-outline-primary mx-2" type="button"
                        onclick="setCase([4818,4389,3348,1804,1347,998,1028])">Case 7</button>
                </div>
            </div>

            <!-- Inputs -->
            <form id="predict-form">
                <div class="text-center my-4">
                    <h4>Adjust Stress Values to See the Result:</h4>

                    <div class="input-container">
                        <!-- 1 -->
                        <div class="input-wrapper">
                            <label for="input1" class="input-label">4in Probe</label>
                            <div class="input-group">
                                <button class="btn btn-secondary btn-sm" type="button"
                                    onclick="adjustInput('input1',1000)">▲</button>
                                <button class="btn btn-secondary btn-sm" type="button"
                                    onclick="adjustInput('input1',100)">▲</button>
                                <input id="input1" name="input1" class="form-control" type="number" step="any" value="0"
                                    min="0" max="20000">
                                <button class="btn btn-secondary btn-sm" type="button"
                                    onclick="adjustInput('input1',-100)">▼</button>
                                <button class="btn btn-secondary btn-sm" type="button"
                                    onclick="adjustInput('input1',-1000)">▼</button>
                            </div>
                        </div>

                        <!-- 2 -->
                        <div class="input-wrapper">
                            <label for="input2" class="input-label">6in Probe</label>
                            <div class="input-group">
                                <button class="btn btn-secondary btn-sm" type="button"
                                    onclick="adjustInput('input2',1000)">▲</button>
                                <button class="btn btn-secondary btn-sm" type="button"
                                    onclick="adjustInput('input2',100)">▲</button>
                                <input id="input2" name="input2" class="form-control" type="number" step="any" value="0"
                                    min="0" max="20000">
                                <button class="btn btn-secondary btn-sm" type="button"
                                    onclick="adjustInput('input2',-100)">▼</button>
                                <button class="btn btn-secondary btn-sm" type="button"
                                    onclick="adjustInput('input2',-1000)">▼</button>
                            </div>
                        </div>

                        <!-- 3 -->
                        <div class="input-wrapper">
                            <label for="input3" class="input-label">10in Probe</label>
                            <div class="input-group">
                                <button class="btn btn-secondary btn-sm" type="button"
                                    onclick="adjustInput('input3',1000)">▲</button>
                                <button class="btn btn-secondary btn-sm" type="button"
                                    onclick="adjustInput('input3',100)">▲</button>
                                <input id="input3" name="input3" class="form-control" type="number" step="any" value="0"
                                    min="0" max="20000">
                                <button class="btn btn-secondary btn-sm" type="button"
                                    onclick="adjustInput('input3',-100)">▼</button>
                                <button class="btn btn-secondary btn-sm" type="button"
                                    onclick="adjustInput('input3',-1000)">▼</button>
                            </div>
                        </div>

                        <!-- 4 -->
                        <div class="input-wrapper">
                            <label for="input4" class="input-label">16in Probe</label>
                            <div class="input-group">
                                <button class="btn btn-secondary btn-sm" type="button"
                                    onclick="adjustInput('input4',1000)">▲</button>
                                <button class="btn btn-secondary btn-sm" type="button"
                                    onclick="adjustInput('input4',100)">▲</button>
                                <input id="input4" name="input4" class="form-control" type="number" step="any" value="0"
                                    min="0" max="20000">
                                <button class="btn btn-secondary btn-sm" type="button"
                                    onclick="adjustInput('input4',-100)">▼</button>
                                <button class="btn btn-secondary btn-sm" type="button"
                                    onclick="adjustInput('input4',-1000)">▼</button>
                            </div>
                        </div>

                        <!-- 5 -->
                        <div class="input-wrapper">
                            <label for="input5" class="input-label">18in Probe</label>
                            <div class="input-group">
                                <button class="btn btn-secondary btn-sm" type="button"
                                    onclick="adjustInput('input5',1000)">▲</button>
                                <button class="btn btn-secondary btn-sm" type="button"
                                    onclick="adjustInput('input5',100)">▲</button>
                                <input id="input5" name="input5" class="form-control" type="number" step="any" value="0"
                                    min="0" max="20000">
                                <button class="btn btn-secondary btn-sm" type="button"
                                    onclick="adjustInput('input5',-100)">▼</button>
                                <button class="btn btn-secondary btn-sm" type="button"
                                    onclick="adjustInput('input5',-1000)">▼</button>
                            </div>
                        </div>

                        <!-- 6 -->
                        <div class="input-wrapper">
                            <label for="input6" class="input-label">20in Probe</label>
                            <div class="input-group">
                                <button class="btn btn-secondary btn-sm" type="button"
                                    onclick="adjustInput('input6',1000)">▲</button>
                                <button class="btn btn-secondary btn-sm" type="button"
                                    onclick="adjustInput('input6',100)">▲</button>
                                <input id="input6" name="input6" class="form-control" type="number" step="any" value="0"
                                    min="0" max="20000">
                                <button class="btn btn-secondary btn-sm" type="button"
                                    onclick="adjustInput('input6',-100)">▼</button>
                                <button class="btn btn-secondary btn-sm" type="button"
                                    onclick="adjustInput('input6',-1000)">▼</button>
                            </div>
                        </div>

                        <!-- 7 -->
                        <div class="input-wrapper">
                            <label for="input7" class="input-label">22in Probe</label>
                            <div class="input-group">
                                <button class="btn btn-secondary btn-sm" type="button"
                                    onclick="adjustInput('input7',1000)">▲</button>
                                <button class="btn btn-secondary btn-sm" type="button"
                                    onclick="adjustInput('input7',100)">▲</button>
                                <input id="input7" name="input7" class="form-control" type="number" step="any" value="0"
                                    min="0" max="20000">
                                <button class="btn btn-secondary btn-sm" type="button"
                                    onclick="adjustInput('input7',-100)">▼</button>
                                <button class="btn btn-secondary btn-sm" type="button"
                                    onclick="adjustInput('input7',-1000)">▼</button>
                            </div>
                        </div>
                    </div>
                </div>

                <button type="submit" class="btn btn-success btn-lg my-4">Run Machine Learning Model</button>
            </form>

            <div id="ml-result-container" class="text-center my-4"></div>

            <!-- Unity NN1 -->
            <div class="text-center my-5">
                <canvas id="unityContainer" width="960" height="400"
                    style="background:#000;display:block;margin:0 auto;"></canvas>
            </div>

            <div class="text-center">
                <h1 class="text-center my-4">Step 2 - Predicting Stress Field</h1>
                <p class="lead">The predicted cut location can be passed to a second model, which will generate a stress
                    field across over 30,000 points, showing stress on the beam after the damage.</p>
            </div>

            <div class="text-center my-3">
                <button class="btn btn-success btn-lg my-4" onclick="runNN2()">Generate Stress Field</button>
            </div>

            <!-- Unity NN2 -->
            <div class="text-center my-5">
                <canvas id="unityContainer2" width="960" height="400"
                    style="background:#000;display:block;margin:0 auto;"></canvas>
            </div>

            <div class="text-center my-4">
                <img src="assets/img/psi_gradient.png" alt="NN2 Output Visualization" style="max-width:50%;height:auto;">
            </div>

        </div>
    </div>

    <!-- Unity loaders -->
    <script src="models/UnityBuild_NN1/WebGL_NN1_Build4.loader.js"></script>
    <script src="models/UnityBuild_NN2/WebGL_NN2_Build2.loader.js"></script>



    <script>
        // NN1
        window.unityInstance = null;
        createUnityInstance(document.querySelector("#unityContainer"), {
            dataUrl: "models/UnityBuild_NN1/WebGL_NN1_Build4.data",
            frameworkUrl: "models/UnityBuild_NN1/WebGL_NN1_Build4.framework.js",
            codeUrl: "models/UnityBuild_NN1/WebGL_NN1_Build4.wasm",
            companyName: "YourCompany",
            productName: "YourProduct",
            productVersion: "1.0"
        }).then(i => { window.unityInstance = i; console.log("Unity NN1 loaded"); })
            .catch(e => console.error("Unity NN1 failed:", e));

        // NN2
        window.unityInstance2 = null;
        createUnityInstance(document.querySelector("#unityContainer2"), {
            dataUrl: "models/UnityBuild_NN2/WebGL_NN2_Build2.data",
            frameworkUrl: "models/UnityBuild_NN2/WebGL_NN2_Build2.framework.js",
            codeUrl: "models/UnityBuild_NN2/WebGL_NN2_Build2.wasm",
            companyName: "YourCompany",
            productName: "NN2 Viewer",
            productVersion: "1.0"
        }).then(i => { window.unityInstance2 = i; console.log("Unity NN2 loaded"); })
            .catch(e => console.error("Unity NN2 failed:", e));
    </script>

    <!-- Form (AJAX) – NOTE: replace endpoints later -->



    <!-- Inline handlers and helpers centralized in external scripts -->

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.20.0/dist/tf.min.js"></script>
    <script src="assets/js/app_models.js?v=6"></script>
    <script src="assets/js/app.js?v=3"></script>



</body>

</html>
